{"version":3,"file":"utils-importJson.js","sourceRoot":"","sources":["../../src/utils/utils-importJson.ts"],"names":[],"mappings":"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","sourcesContent":["import { EventEmitter } from '@stencil/core';\r\n\r\nimport { JsonSQLite, JsonProgressListener, JsonView } from '../interfaces/interfaces';\r\nimport { setVersion, beginTransaction, rollbackTransaction, commitTransaction,\r\n  execute, dbChanges, run, queryAll, isTableExists } from './utils-sqlite';\r\nimport { dropAll } from './utils-drop';\r\nimport { getTableColumnNamesTypes, getValues } from './utils-json';\r\n\r\nexport const createDatabaseSchema = async (db: any, jsonData: JsonSQLite): Promise<number> => {\r\n  let changes = -1;\r\n  const version: number = jsonData.version;\r\n  try {\r\n      // set User Version PRAGMA\r\n      await setVersion(db, version);\r\n      // DROP ALL when mode=\"full\"\r\n      if (jsonData.mode === 'full') {\r\n        await dropAll(db);\r\n      }\r\n      // create database schema\r\n      changes = await createSchema(db, jsonData);\r\n      return Promise.resolve(changes);\r\n\r\n  } catch (err) {\r\n    return Promise.reject(\r\n      new Error('CreateDatabaseSchema: ' + `${err.message}`),\r\n    );\r\n  }\r\n}\r\nexport const createSchema = async (db: any, jsonData: any): Promise<number> => {\r\n  // create the database schema\r\n  let changes = 0;\r\n  try {\r\n    // start a transaction\r\n    await beginTransaction(db, true);\r\n  } catch (err) {\r\n    return Promise.reject(new Error(`CreateSchema: ${err.message}`));\r\n  }\r\n\r\n  const stmts = await createSchemaStatement(jsonData);\r\n  if (stmts.length > 0) {\r\n    const schemaStmt: string = stmts.join('\\n');\r\n    try {\r\n      changes = await execute(db, schemaStmt, true);\r\n      if (changes < 0) {\r\n        try {\r\n          await rollbackTransaction(db, true);\r\n        } catch (err) {\r\n          return Promise.reject(\r\n            new Error('CreateSchema: changes < 0 ' + `${err.message}`),\r\n          );\r\n        }\r\n      }\r\n    } catch (err) {\r\n      const msg = err.message;\r\n      try {\r\n        await rollbackTransaction(db, true);\r\n        return Promise.reject(new Error(`CreateSchema: ${msg}`));\r\n      } catch (err) {\r\n        return Promise.reject(\r\n          new Error('CreateSchema: changes < 0 ' + `${err.message}: ${msg}`),\r\n        );\r\n      }\r\n    }\r\n  }\r\n  try {\r\n    await commitTransaction(db, true);\r\n    return Promise.resolve(changes);\r\n  } catch (err) {\r\n    return Promise.reject(\r\n      new Error('CreateSchema: commit ' + `${err.message}`),\r\n    );\r\n  }\r\n}\r\nexport const createSchemaStatement = async (jsonData: any): Promise<string[]> => {\r\n  const statements: string[] = [];\r\n  let isLastModified = false;\r\n  let isSqlDeleted = false;\r\n\r\n  // Prepare the statement to execute\r\n  try {\r\n    for (const jTable of jsonData.tables) {\r\n      if (jTable.schema != null && jTable.schema.length >= 1) {\r\n        // create table\r\n        statements.push('CREATE TABLE IF NOT EXISTS ' + `${jTable.name} (`);\r\n        for (let j = 0; j < jTable.schema.length; j++) {\r\n          if (j === jTable.schema.length - 1) {\r\n            if (jTable.schema[j].column) {\r\n              statements.push(\r\n                `${jTable.schema[j].column} ${jTable.schema[j].value}`,\r\n              );\r\n              if(jTable.schema[j].column === \"last_modified\") {\r\n                isLastModified = true;\r\n              }\r\n              if(jTable.schema[j].column === \"sql_deleted\") {\r\n                isSqlDeleted = true;\r\n              }\r\n            } else if (jTable.schema[j].foreignkey) {\r\n              statements.push(\r\n                `FOREIGN KEY (${jTable.schema[j].foreignkey}) ${jTable.schema[j].value}`,\r\n              );\r\n            } else if (jTable.schema[j].constraint) {\r\n              statements.push(\r\n                `CONSTRAINT ${jTable.schema[j].constraint} ${jTable.schema[j].value}`,\r\n              );\r\n            }\r\n          } else {\r\n            if (jTable.schema[j].column) {\r\n              statements.push(\r\n                `${jTable.schema[j].column} ${jTable.schema[j].value},`,\r\n              );\r\n            } else if (jTable.schema[j].foreignkey) {\r\n              statements.push(\r\n                `FOREIGN KEY (${jTable.schema[j].foreignkey}) ${jTable.schema[j].value},`,\r\n              );\r\n            } else if (jTable.schema[j].primarykey) {\r\n              statements.push(\r\n                `FOREIGN KEY ${jTable.schema[j].value},`,\r\n              );\r\n            } else if (jTable.schema[j].constraint) {\r\n              statements.push(\r\n                `CONSTRAINT ${jTable.schema[j].constraint} ${jTable.schema[j].value},`,\r\n              );\r\n            }\r\n          }\r\n        }\r\n        statements.push(');');\r\n        if(isLastModified && isSqlDeleted) {\r\n          // create trigger last_modified associated with the table\r\n          let trig = 'CREATE TRIGGER IF NOT EXISTS ';\r\n          trig += `${jTable.name}`;\r\n          trig += `_trigger_last_modified `;\r\n          trig += `AFTER UPDATE ON ${jTable.name} `;\r\n          trig += 'FOR EACH ROW WHEN NEW.last_modified < ';\r\n          trig += 'OLD.last_modified BEGIN UPDATE ';\r\n          trig += `${jTable.name} `;\r\n          trig += `SET last_modified = `;\r\n          trig += \"(strftime('%s','now')) WHERE id=OLD.id; END;\";\r\n          statements.push(trig);\r\n        }\r\n      }\r\n\r\n      if (jTable.indexes != null && jTable.indexes.length >= 1) {\r\n        for (const jIndex of jTable.indexes) {\r\n          const tableName = jTable.name;\r\n          let stmt = `CREATE ${\r\n            Object.keys(jIndex).includes('mode') ? jIndex.mode + ' ' : ''\r\n          } INDEX IF NOT EXISTS `;\r\n          stmt += `${jIndex.name} ON ${tableName} (${jIndex.value});`;\r\n          statements.push(stmt);\r\n        }\r\n      }\r\n      if (jTable.triggers != null && jTable.triggers.length >= 1) {\r\n        for (const jTrg of jTable.triggers) {\r\n          const tableName = jTable.name;\r\n          if (jTrg.timeevent.toUpperCase().endsWith(\" ON\")) {\r\n            jTrg.timeevent = jTrg.timeevent.substring(0, jTrg.timeevent.length - 3);\r\n        }\r\n\r\n          let stmt = `CREATE TRIGGER IF NOT EXISTS `;\r\n          stmt += `${jTrg.name} ${jTrg.timeevent} ON ${tableName} `;\r\n          if (jTrg.condition) stmt += `${jTrg.condition} `;\r\n          stmt += `${jTrg.logic};`;\r\n          statements.push(stmt);\r\n        }\r\n      }\r\n    }\r\n    return Promise.resolve(statements);\r\n  } catch (err) {\r\n    return Promise.reject(err);\r\n  }\r\n}\r\nexport const createTablesData = async (db: any, jsonData: JsonSQLite,\r\n                                       importProgress: EventEmitter<JsonProgressListener>): Promise<number> => {\r\n  let changes = 0;\r\n  let isValue = false;\r\n  let lastId = -1;\r\n  let msg = '';\r\n  let initChanges = -1;\r\n  try {\r\n    initChanges = await dbChanges(db);\r\n    // start a transaction\r\n    await beginTransaction(db, true);\r\n  } catch (err) {\r\n    return Promise.reject(new Error(`createTablesData: ${err.message}`));\r\n  }\r\n  for (const jTable of jsonData.tables) {\r\n    if (jTable.values != null && jTable.values.length >= 1) {\r\n      // Create the table's data\r\n      try {\r\n        lastId = await createTableData(db, jTable, jsonData.mode);\r\n        const msg: string = `create table data ${jTable.name}`;\r\n        importProgress.emit({progress: msg});\r\n        if (lastId < 0) break;\r\n        isValue = true;\r\n      } catch (err) {\r\n        msg = err.message;\r\n        isValue = false;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  if (isValue) {\r\n    try {\r\n      await commitTransaction(db, true);\r\n      changes = (await dbChanges(db)) - initChanges;\r\n      return Promise.resolve(changes);\r\n    } catch (err) {\r\n      return Promise.reject(\r\n        new Error('CreateTablesData: ' + `${err.message}`),\r\n      );\r\n    }\r\n  } else {\r\n    if(msg.length > 0) {\r\n      try {\r\n        await rollbackTransaction(db, true);\r\n        return Promise.reject(new Error(`CreateTablesData: ${msg}`));\r\n      } catch (err) {\r\n        return Promise.reject(\r\n          new Error('CreateTablesData: ' + `${err.message}: ${msg}`),\r\n        );\r\n      }\r\n    } else {\r\n      // case were no values given\r\n      return Promise.resolve(0);\r\n    }\r\n}\r\n}\r\nexport const createTableData = async (db: any, table: any, mode: string): Promise<number> => {\r\n  let lastId = -1;\r\n  try {\r\n    // Check if the table exists\r\n    const tableExists = await isTableExists(db, table.name);\r\n    if (!tableExists) {\r\n      return Promise.reject(\r\n        new Error('CreateTableData: Table ' + `${table.name} does not exist`),\r\n      );\r\n    }\r\n\r\n    // Get the column names and types\r\n    const tableNamesTypes: any = await getTableColumnNamesTypes(db, table.name);\r\n    const tableColumnTypes: string[] = tableNamesTypes.types;\r\n    const tableColumnNames: string[] = tableNamesTypes.names;\r\n    if (tableColumnTypes.length === 0) {\r\n      return Promise.reject(\r\n        new Error(\r\n          'CreateTableData: Table ' + `${table.name} info does not exist`,\r\n        ),\r\n      );\r\n    }\r\n    // Loop on Table Values\r\n    for (let j = 0; j < table.values.length; j++) {\r\n      let row = table.values[j];\r\n      let isRun: boolean = true;\r\n      const stmt: string = await createRowStatement(db, tableColumnNames, row,\r\n                                                    j, table.name, mode);\r\n      isRun = await checkUpdate(db, stmt, row, table.name, tableColumnNames);\r\n      if(isRun) {\r\n        if(stmt.substring(0,6).toUpperCase() === \"DELETE\") {\r\n          row = [];\r\n        }\r\n        lastId = await run(db, stmt, row, true);\r\n        if (lastId < 0) {\r\n          return Promise.reject(new Error('CreateTableData: lastId < 0'));\r\n        }\r\n      } else {\r\n        lastId = 0;\r\n      }\r\n    }\r\n    return Promise.resolve(lastId);\r\n  } catch (err) {\r\n    return Promise.reject(new Error(`CreateTableData: ${err.message}`));\r\n  }\r\n}\r\nexport const createRowStatement = async (db: any, tColNames: string[],\r\n                                         row: any[], j: number, tableName: string,\r\n                                         mode: string): Promise<string> => {\r\n\r\n  // Check the row number of columns\r\n  if (row.length != tColNames.length || row.length ===0 || tColNames.length === 0) {\r\n    return Promise.reject(\r\n      new Error(\r\n        `CreateRowStatement: Table ${tableName} ` +\r\n          `values row ${j} not correct length`,\r\n      ),\r\n    );\r\n  }\r\n  try {\r\n    const retisIdExists: boolean = await isIdExists(db, tableName, tColNames[0], row[0]);\r\n    let stmt: string;\r\n    if (mode === 'full' || (mode === 'partial' && !retisIdExists)) {\r\n      // Insert\r\n      const nameString: string = tColNames.join();\r\n      const questionMarkString = await createQuestionMarkString(tColNames.length);\r\n      stmt = `INSERT INTO ${tableName} (${nameString}) VALUES (`;\r\n      stmt += `${questionMarkString});`;\r\n\r\n    } else {\r\n      // Update or Delete\r\n      let isUpdate = true\r\n      const isColDeleted = (element: string) => element === `sql_deleted`;\r\n      const idxDelete = tColNames.findIndex(isColDeleted);\r\n      if(idxDelete >= 0) {\r\n        if(row[idxDelete] === 1) {\r\n          isUpdate = false;\r\n          stmt =\r\n          `DELETE FROM ${tableName} WHERE `;\r\n          if( typeof row[0] == \"string\") {\r\n            stmt +=\r\n            `${tColNames[0]} = '${row[0]}';`;\r\n          } else {\r\n            stmt +=\r\n            `${tColNames[0]} = ${row[0]};`;\r\n          }\r\n        }\r\n      }\r\n      if(isUpdate) {\r\n        // Update\r\n        const setString: string = await setNameForUpdate(tColNames);\r\n        if (setString.length === 0) {\r\n          return Promise.reject(\r\n            new Error(\r\n              `CreateRowStatement: Table ${tableName} ` +\r\n                `values row ${j} not set to String`,\r\n            ),\r\n          );\r\n        }\r\n        stmt =\r\n          `UPDATE ${tableName} SET ${setString} WHERE `;\r\n        if( typeof row[0] == \"string\") {\r\n          stmt +=\r\n          `${tColNames[0]} = '${row[0]}';`;\r\n        } else {\r\n          stmt +=\r\n          `${tColNames[0]} = ${row[0]};`;\r\n        }\r\n      }\r\n    }\r\n    return Promise.resolve(stmt);\r\n  } catch (err) {\r\n    return Promise.reject(new Error(`CreateRowStatement: ${err.message}`));\r\n  }\r\n}\r\nexport const checkUpdate = async (db: any, stmt: string, values: any[], tbName: string,\r\n                                  tColNames: string[]): Promise<boolean> => {\r\n  let isRun: boolean = true;\r\n  if (stmt.substring(0, 6) === \"UPDATE\") {\r\n    try {\r\n      let query = `SELECT * FROM ${tbName} WHERE `;\r\n      if( typeof values[0] == \"string\") {\r\n        query +=\r\n        `${tColNames[0]} = '${values[0]}';`;\r\n      } else {\r\n        query +=\r\n        `${tColNames[0]} = ${values[0]};`;\r\n      }\r\n\r\n\r\n      const resQuery: any[] = await getValues(db, query, tbName);\r\n      let resValues: any[] = [];\r\n      if(resQuery.length > 0) {\r\n        resValues = resQuery[0];\r\n      }\r\n      if(values.length > 0  && resValues.length > 0\r\n                            && values.length === resValues.length) {\r\n        for(let i = 0; i < values.length; i++) {\r\n          if(values[i] !== resValues[i]) {\r\n            return Promise.resolve(true);\r\n          }\r\n        }\r\n        return Promise.resolve(false);\r\n      } else {\r\n        const msg = \"Both arrays not the same length\"\r\n        return Promise.reject(new Error(`CheckUpdate: ${msg}`));\r\n      }\r\n    } catch (err) {\r\n      return Promise.reject(new Error(`CheckUpdate: ${err.message}`));\r\n    }\r\n  } else {\r\n    return Promise.resolve(isRun);\r\n  }\r\n}\r\nexport const isIdExists = async (db: any, dbName: string, firstColumnName: string,\r\n                                 key: any): Promise<boolean> => {\r\n  let ret = false;\r\n  let query: string =\r\n    `SELECT ${firstColumnName} FROM ` +\r\n    `${dbName} WHERE ${firstColumnName} = `;\r\n  if (typeof key === 'number') query += `${key};`;\r\n  if (typeof key === 'string') query += `'${key}';`;\r\n\r\n  try {\r\n    const resQuery: any[] = await queryAll(db, query, []);\r\n    if (resQuery.length === 1) ret = true;\r\n    return Promise.resolve(ret);\r\n  } catch (err) {\r\n    return Promise.reject(new Error(`IsIdExists: ${err.message}`));\r\n  }\r\n}\r\nexport const isType = async (type: string, value: any): Promise<void> => {\r\n  let ret = false;\r\n  if (type === 'NULL' && typeof value === 'object') ret = true;\r\n  if (type === 'TEXT' && typeof value === 'string') ret = true;\r\n  if (type === 'INTEGER' && typeof value === 'number') ret = true;\r\n  if (type === 'REAL' && typeof value === 'number') ret = true;\r\n  if (type === 'BLOB' && typeof value === 'string') ret = true;\r\n  if (ret) {\r\n    return Promise.resolve();\r\n  } else {\r\n    return Promise.reject(new Error('IsType: not a SQL Type'));\r\n  }\r\n}\r\nexport const checkColumnTypes = async (tableTypes: any[], rowValues: any[]): Promise<void> => {\r\n  for (let i = 0; i < rowValues.length; i++) {\r\n    if (rowValues[i] != null) {\r\n      try {\r\n        await isType(tableTypes[i], rowValues[i]);\r\n      } catch (err) {\r\n        return Promise.reject(new Error('CheckColumnTypes: Type not found'));\r\n      }\r\n    }\r\n  }\r\n  return Promise.resolve();\r\n}\r\nexport const createQuestionMarkString = async (length: number): Promise<string> => {\r\n  let retString = '';\r\n  for (let i = 0; i < length; i++) {\r\n    retString += '?,';\r\n  }\r\n  if (retString.length > 1) {\r\n    retString = retString.slice(0, -1);\r\n    return Promise.resolve(retString);\r\n  } else {\r\n    return Promise.reject(new Error('CreateQuestionMarkString: length = 0'));\r\n  }\r\n}\r\nexport const setNameForUpdate = async (names: string[]): Promise<string> => {\r\n  let retString = '';\r\n  for (const name of names) {\r\n    retString += `${name} = ? ,`;\r\n  }\r\n  if (retString.length > 1) {\r\n    retString = retString.slice(0, -1);\r\n    return Promise.resolve(retString);\r\n  } else {\r\n    return Promise.reject(new Error('SetNameForUpdate: length = 0'));\r\n  }\r\n}\r\n\r\nexport const createView = async (mDB: any, view: JsonView): Promise<void> => {\r\n  const stmt = `CREATE VIEW IF NOT EXISTS ${view.name} AS ${view.value};`;\r\n  try {\r\n    const changes = await execute(mDB, stmt, true);\r\n    if (changes < 0) {\r\n      return Promise.reject(new Error(`CreateView: ${view.name} failed`));\r\n    }\r\n    return Promise.resolve();\r\n  } catch (err) {\r\n    return Promise.reject(new Error(`CreateView: ${err.message}`));\r\n  }\r\n}\r\nexport const createViews = async (mDB: any, jsonData: JsonSQLite): Promise<number> => {\r\n  let isView = false;\r\n  let msg = '';\r\n  let initChanges = -1;\r\n  let changes = -1;\r\n  try {\r\n    initChanges = await dbChanges(mDB);\r\n    // start a transaction\r\n    await beginTransaction(mDB, true);\r\n  } catch (err) {\r\n    return Promise.reject(new Error(`createViews: ${err.message}`));\r\n  }\r\n  for (const jView of jsonData.views) {\r\n    if (jView.value != null) {\r\n      // Create the view\r\n      try {\r\n        await createView(mDB, jView);\r\n        isView = true;\r\n      } catch (err) {\r\n        msg = err.message;\r\n        isView = false;\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  if (isView) {\r\n    try {\r\n      await commitTransaction(mDB, true);\r\n      changes = (await dbChanges(mDB)) - initChanges;\r\n      return Promise.resolve(changes);\r\n    } catch (err) {\r\n      return Promise.reject(new Error('createViews: ' + `${err.message}`));\r\n    }\r\n  } else {\r\n    if (msg.length > 0) {\r\n      try {\r\n        await rollbackTransaction(mDB, true);\r\n        return Promise.reject(new Error(`createViews: ${msg}`));\r\n      } catch (err) {\r\n        return Promise.reject(\r\n          new Error('createViews: ' + `${err.message}: ${msg}`),\r\n        );\r\n      }\r\n    } else {\r\n      // case were no views given\r\n      return Promise.resolve(0);\r\n    }\r\n  }\r\n}\r\n\r\n"]}